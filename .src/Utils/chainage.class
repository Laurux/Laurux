' Gambas class file

Private $text As Object[]
Private $obs As Observer

Public Sub _new(value As Object[])

  Dim i As Integer
  
  $text = value
  For i = 0 To $text.Max
    $obs = New Observer($text[i]) As "saisie"
  Next

End

Public Sub saisie_gotfocus()

  Try Utils.ObsGotf(Last)

End

Public Sub saisie_lostfocus()

  Try Utils.ObsLstf(Last)

End

Public Sub saisie_keypress()

  Dim i As Integer
  
  Select Case Key.Code
   
    Case Key.Up, Key.BackTab
      i = recherche(Last)
      If i > -1 Then
        i = i - 1
        If i = -1 Then i = $text.Max 
        $text[i].setfocus
        Try $text[i].Select
      Endif
    
    Case Key.Down, Key.Enter, Key.Return, Key.Tab
      i = recherche(Last)
      If i > -1 Then
        If Key.Code = Key.tab Then Stop Event
        i = i + 1
        If i > $text.Max Then i = 0
        $text[i].setfocus
        Try $text[i].Select
      Endif
      
  End Select

End

Private Function recherche(text As Object) As Integer
  
  Dim i As Integer
  
  Repeat
    If $text[i] = text Then Return i
    Inc i
  Until i = $text.Count
  
  Return -1
  
End

Public Sub add(value As Object[])

  Dim i As Integer
  
  For i = 0 To value.Max
    $text.Add(value[i])
    $obs = New Observer($text[$text.Max]) As "saisie"
  Next

End

Public Sub addintercale(text As Object, value As Object)

  Dim i As Integer
  
  i = recherche(text)
  If i > -1 Then $text.Add(value, i)
  
End

Public Sub modif(anc As Object, nouv As Object)

  Dim i As Object
  
  i = recherche(anc)
  $text[i] = nouv

End
